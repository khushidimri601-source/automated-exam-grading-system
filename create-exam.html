<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Exam - Exam Grading System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="teacher-dashboard.html" class="navbar-brand">üìö Teacher Portal</a>
            <div class="navbar-links">
                <a href="teacher-dashboard.html">Dashboard</a>
                <button class="btn btn-danger" onclick="logout()" style="padding: 8px 16px;">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <div class="card-header">
                <h2>üìù Create New Exam</h2>
            </div>

            <div id="alertContainer"></div>

            <form id="examForm">
                <div class="form-group">
                    <label for="title">Exam Title</label>
                    <input type="text" id="title" class="form-control" placeholder="e.g., Mathematics Final Exam" required>
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" class="form-control" rows="3" placeholder="Brief description of the exam" required></textarea>
                </div>

                <div class="form-group">
                    <label for="duration">Duration (minutes)</label>
                    <input type="number" id="duration" class="form-control" placeholder="e.g., 60" min="5" required>
                </div>

                <div class="card-header mb-2">
                    <h3>üìÖ Exam Scheduling</h3>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="startDate">Start Date (optional)</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date (optional)</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="startTime">Start Time (optional)</label>
                        <input type="time" id="startTime" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="endTime">End Time (optional)</label>
                        <input type="time" id="endTime" class="form-control">
                    </div>
                </div>

                <div class="card-header mb-2">
                    <h3>‚öôÔ∏è Exam Settings</h3>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="shuffleQuestions" style="margin-right: 10px; width: 20px; height: 20px;">
                        Shuffle Questions
                    </label>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="shuffleOptions" style="margin-right: 10px; width: 20px; height: 20px;">
                        Shuffle Answer Options
                    </label>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="allowRetakes" style="margin-right: 10px; width: 20px; height: 20px;">
                        Allow Multiple Attempts (Retakes)
                    </label>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="showResultsImmediately" checked style="margin-right: 10px; width: 20px; height: 20px;">
                        Show Results Immediately After Submission
                    </label>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="passingScore">Passing Score (%)</label>
                        <input type="number" id="passingScore" class="form-control" value="60" min="0" max="100" step="1">
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="negativeMarking" style="margin-right: 10px; width: 20px; height: 20px;">
                            Enable Negative Marking
                        </label>
                        <input type="number" id="negativeMarkValue" class="form-control mt-1" value="0.25" min="0" max="1" step="0.05" placeholder="Negative mark per wrong answer" style="display: none;">
                    </div>
                </div>

                <script>
                    document.getElementById('negativeMarking').addEventListener('change', function() {
                        document.getElementById('negativeMarkValue').style.display = this.checked ? 'block' : 'none';
                    });
                </script>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="saveToBank" style="margin-right: 10px; width: 20px; height: 20px;">
                        Save Questions to Question Bank
                    </label>
                </div>

                <div class="card-header mb-2">
                    <h3>Questions</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="loadFromQuestionBank()">üìö Load from Question Bank</button>
                        <button type="button" class="btn btn-secondary" onclick="importAnswerKey()">üóùÔ∏è Import Answer Key (PDF/DOCX)</button>
                    </div>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="allowMissingCorrectAnswers" style="margin-right: 10px; width: 20px; height: 20px;">
                            I will import the answer key (allow missing correct answers for now)
                        </label>
                        <p style="color: var(--gray); font-size: 13px; margin-top: 6px;">
                            If enabled, the form won‚Äôt block you when some correct answers are blank. You can import the answer key later.
                        </p>
                    </div>
                </div>

                <div id="questionsContainer"></div>

                <button type="button" class="btn btn-secondary mb-3" onclick="addQuestion()">+ Add Question</button>

                <div class="grid grid-2">
                    <button type="button" class="btn btn-outline" onclick="window.location.href='teacher-dashboard.html'">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Exam</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/create-exam.js"></script>
    <script>
        // Check if editing
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('edit') === 'true') {
            const examId = localStorage.getItem('editingExamId');
            if (examId && typeof loadExamForEdit === 'function') {
                loadExamForEdit(examId);
            }
        }
        
        // Load selected questions from bank
        const selectedQuestions = localStorage.getItem('selectedBankQuestions');
        if (selectedQuestions) {
            try {
                const questions = JSON.parse(selectedQuestions);
                questions.forEach(q => {
                    addQuestionWithData(q);
                });
                localStorage.removeItem('selectedBankQuestions');
            } catch (e) {
                console.error('Error loading bank questions:', e);
            }
        }
    </script>
</body>
</html>
